
# mvp28-fix 全局测试文档

> 目标：覆盖“可本地复现的质量门禁 + 关键路由/API 策略 + 版本隔离”测试，并记录执行结果。  
> 说明：本项目包含外部依赖（CloudBase / Supabase / 支付平台 / AI 模型）。为避免触发真实扣费/真实订单/真实数据删除，本次默认只做**安全的冒烟测试**（如 401/400/404 策略、健康检查、构建与 lint）。需要真实联调时见文末“需要联调的用例”。

## 1. 测试环境

- 运行目录：`mvp28-fix/`
- 运行系统：Windows（PowerShell）
- 部署版本（来自 `.env.local`）：`NEXT_PUBLIC_DEFAULT_LANGUAGE=zh`（国内版）

## 2. 测试清单（Checklist）

> 结果字段说明：`PASS` / `FAIL` / `SKIP`（有风险或依赖外部配置不满足）

| ID | 测试项 | 预期结果 | 执行方式（命令/步骤） | 结果 | 关键输出/备注 |
|---|---|---|---|---|---|
| T01 | Node / 包管理器版本 | 能正常输出版本号 | `node -v`、`pnpm -v` | PASS | Node `v20.18.0`；pnpm `10.24.0` |
| T02 | 依赖完整性 | 可正常执行脚本 | - | SKIP | 与 T10 重复（lint/build 已覆盖依赖可用性） |
| T10 | ESLint / Next Lint | 0 exit code | `pnpm -C mvp28-fix lint` | FAIL | 主要错误：`react/no-unescaped-entities`（`app/admin/ads/page.tsx`、`app/admin/releases/page.tsx`、`app/admin/social-links/page.tsx`）；`app/payment/stripe/success/page.tsx` 有 effect 内同步 setState 警告升级为 error |
| T11 | Next Build | build 成功 | `pnpm -C mvp28-fix build` | PASS | build 成功；提示：`/api/domestic/chat/{send,stream}` re-export 导致 `runtime/dynamic` 识别警告（不影响编译） |
| T20 | Dev Server 启动 | 本地 3000 端口可访问 | `pnpm -C mvp28-fix dev`（后台启动） | PASS | 启动成功：`http://localhost:3000`；日志：`mvp28-fix/.tmp/dev-20251220-220815.out.log` |
| T21 | 首页渲染 | `GET /` 返回 200 | `GET http://localhost:3000/` | PASS | HTTP 200 |
| T22 | 国内健康检查 | `GET /api/domestic/health` 返回 200 | `GET http://localhost:3000/api/domestic/health` | PASS | HTTP 200 |
| T23 | 国际接口隔离 | 国内版访问 `/api/international/*` 返回 404 | `GET http://localhost:3000/api/international/health` | PASS | HTTP 404 |
| T24 | 模型列表（国内） | 返回 200 且为 JSON 列表 | `GET http://localhost:3000/api/domestic/models` | PASS | HTTP 200；返回 `{ success: true, data: [...] }`（本次返回 12 个模型） |
| T30 | 认证接口参数校验（登录） | 缺少字段返回 400 | `POST /api/auth/login` 空 body | PASS | HTTP 400；`{\"error\":\"Email and password required\"}` |
| T31 | 认证接口参数校验（注册） | 缺少字段返回 400 | `POST /api/auth/register` 空 body | PASS | HTTP 400；`{\"error\":\"Email and password required\"}` |
| T32 | 会话接口未登录 | 返回 401 | `GET /api/conversations`（无 cookie） | PASS | HTTP 401 |
| T40 | 支付接口隔离（Stripe/PayPal） | 国内版访问 Stripe/PayPal 返回 404 | `POST /api/payment/stripe/create` | PASS | HTTP 404（被 `middleware.ts` 版本隔离拦截） |
| T41 | 国内支付接口未登录 | 返回 401（不应触发下单） | `POST /api/payment/wechat/create` 空 body | PASS | HTTP 401；`{\"success\":false,\"error\":\"用户未登录\"}` |
| T90 | 删除账号（高风险） | 会真实删除数据 | **默认不执行**（需明确确认） | SKIP | 需要用户明确确认后再测 |

## 3. 执行记录（由本次测试自动回填）

- 执行时间：2025-12-20 22:08 - 22:38
- 总结：build/关键路由冒烟通过；lint 当前失败（存在少量 ESLint error），高风险用例默认跳过

## 4. 需要联调的用例（依赖外部服务/可能产生费用）

> 以下用例建议在“测试账号 + 沙箱环境/测试商户号”下执行，并在执行前确认不会影响生产数据。

- L01（国内）：CloudBase 邮箱注册/登录真实流程（需要 CloudBase env 配置）
- L02（国内）：微信扫码登录全链路（需要微信开放平台/回调）
- L03（国内）：DashScope 流式聊天（会消耗模型额度/可能产生费用）
- L04（国内）：微信/支付宝真实下单与回调（会创建订单/可能产生费用）
- L05（国际）：Supabase Google OAuth（需要 Supabase 配置）
- L06（国际）：Mistral 流式聊天（会消耗模型额度/可能产生费用）
- L07（国际）：Stripe/PayPal 真实下单与 webhook（会创建订单/可能产生费用）
